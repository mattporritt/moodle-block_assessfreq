{"version":3,"sources":["../src/main.js"],"names":["define","ajax","Main","today","Date","eventArray","stringArray","daysInMonth","month","year","getDate","createTables","calendarContainer","num","i","container","document","createElement","classList","add","table","thead","tbody","id","monthRow","dayrow","monthHeader","colSpan","innerHTML","j","dayHeader","appendChild","generateCalendar","containerdiv","firstDay","getDay","tbl","getElementsByTagName","monthEvents","date","row","cell","cellText","createTextNode","hasOwnProperty","heatClass","getFullYear","getMonth","createCalendars","containerdivs","spinner","call","methodname","args","done","response","JSON","parse","length","fail","window","console","log","then","remove","init","root","children"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the myoverview block.\n *\n * @package    block_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/ajax'], function(ajax) {\n\n    /**\n     * Module level variables.\n     */\n    var Main = {};\n    var today = new Date();\n    var eventArray = [];\n    var stringArray = [];\n\n    /**\n     * Check how many days in a month code.\n     * from https://dzone.com/articles/determining-number-days-month.\n     */\n    function daysInMonth(month, year) {\n        return 32 - new Date(year, month, 32).getDate();\n    }\n\n    /**\n     * Construct the tables.\n     *\n     */\n    function createTables(calendarContainer, month, num) {\n        // Itterate through and build are tables.\n        for (let i = 0; i < num; i++) {\n            // Setup some elements.\n            let container = document.createElement(\"div\");\n            container.classList.add(\"block-assessfreq-month\");\n            let table = document.createElement(\"table\");\n            let thead = document.createElement(\"thead\");\n            let tbody = document.createElement(\"tbody\");\n            tbody.id = \"calendar-body\";\n            let monthRow = document.createElement(\"tr\");\n            let dayrow = document.createElement(\"tr\");\n            let monthHeader = document.createElement(\"th\");\n            monthHeader.colSpan = 7;\n            monthHeader.innerHTML = stringArray['months'][month];\n\n            for (let j = 0; j < 7; j++) {\n                let dayHeader = document.createElement(\"th\");\n                dayHeader.innerHTML = stringArray['days'][j];\n                dayrow.appendChild(dayHeader);\n            }\n\n            // Construct the table.\n            monthRow.appendChild(monthHeader);\n\n            thead.appendChild(monthRow);\n            thead.appendChild(dayrow);\n\n            table.appendChild(thead);\n            table.appendChild(tbody);\n\n            container.appendChild(table);\n\n            // Add to parent.\n            calendarContainer.appendChild(container);\n\n            // Increment variables.\n            month++;\n        }\n\n\n    }\n\n    /**\n     * Generate calendar markup for the month.\n     */\n    function generateCalendar(month, year, containerdiv) {\n\n        let firstDay = (new Date(year, month)).getDay();  // Get the starting day of the month.\n        var tbl = containerdiv.getElementsByTagName(\"tbody\")[0];\n        var monthEvents = eventArray[year][(month + 1)];  // We add one due to month diferences between PHP and JS.\n\n        // Clearing all previous cells.\n        tbl.innerHTML = \"\";\n\n        // Creating all cells.\n        let date = 1;\n\n        for (let i = 0; i < 6; i++) {\n            // Creates a table row.\n            let row = document.createElement(\"tr\");\n\n            // Creating individual cells, filing them up with data.\n            for (let j = 0; j < 7; j++) {\n                if (i === 0 && j < firstDay) {\n                    var cell = document.createElement(\"td\");\n                    var cellText = document.createTextNode(\"\");\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                }\n                else if (date > daysInMonth(month, year)) {\n                    break;\n                }\n\n                else {\n                    cell = document.createElement(\"td\");\n                    cellText = document.createTextNode(date);\n                    if ((typeof monthEvents !== \"undefined\") && (monthEvents.hasOwnProperty(date))) {\n                        var heatClass = \"block-assessfreq-heat-\" + monthEvents[date]['heat'];\n                        cell.classList.add(heatClass);\n                    }\n                    if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {\n                        cell.classList.add(\"bg-info\");\n                    } // Color today's date.\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                    date++;\n                }\n\n            }\n\n            tbl.appendChild(row); // Appending each row into calendar body.\n        }\n    }\n\n    /**\n     * Create calendars.\n     */\n    function createCalendars(containerdivs, month, year, calendarContainer, spinner) {\n        // Get the events to use in the mapping.\n        ajax.call([{\n            methodname: 'block_assessfreq_get_frequency',\n            args: {},\n        }])[0].done(function(response) {\n            eventArray = JSON.parse(response);\n            // Generate calendar on response.\n            for (let i = 0; i < containerdivs.length; i++) {\n                generateCalendar(month, year, containerdivs[i]);\n                month++;\n            }\n        }).fail(function(response) {\n            // TODO: add an alert here like you did for the async backup stuff.\n            window.console.log(response);\n        }).then(function(){\n            calendarContainer.classList.remove(\"block-assessfreq.block-assessfreq-row-hidden\");\n            calendarContainer.classList.add(\"block-assessfreq.block-assessfreq-row\");\n            spinner.remove();\n        });\n    }\n\n    /**\n     * Initialise all of the modules for the assessment frequency block.\n     *\n     * @param {object} root The root element for the assessment frequency block.\n     */\n    Main.init = function(root, spinner) {\n        // Get the containers that will hold the months.\n        var calendarContainer = root;\n        var containerdivs = calendarContainer.children;\n\n        // Start with current month and year.\n        var month = today.getMonth();\n        var year = today.getFullYear();\n\n        // Make ajax call to get all the strings we'll need.\n        // This is more efficient than making an ajax call per string.\n        ajax.call([{\n            methodname: 'block_assessfreq_get_strings',\n            args: {},\n        }])[0].done(function(response) {\n            stringArray = JSON.parse(response);\n            // Create the table shell.\n            createTables(calendarContainer, month, 4);\n        }).fail(function(response) {\n            // TODO: add an alert here like you did for the async backup stuff.\n            window.console.log(response);\n        }).then(function() {\n            createCalendars(containerdivs, month, year, calendarContainer, spinner);\n        });\n\n    };\n\n    return Main;\n});\n"],"file":"main.min.js"}