{"version":3,"sources":["../src/main.js"],"names":["define","ajax","Main","today","Date","eventArray","daysInMonth","month","year","getDate","generateCalendar","containerdiv","firstDay","getDay","tbl","getElementsByTagName","monthEvents","innerHTML","date","i","row","document","createElement","j","cell","cellText","createTextNode","appendChild","hasOwnProperty","heatClass","classList","add","getFullYear","getMonth","init","root","containerdivs","children","call","methodname","args","done","response","JSON","parse","length","fail","window","console","log"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the myoverview block.\n *\n * @package    block_assessfreq\n * @copyright  2020 Matt Porritt <mattp@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/ajax'], function(ajax) {\n\n    /**\n     * Module level variables.\n     */\n    var Main = {};\n    var today = new Date();\n    var eventArray = [];\n\n    /**\n     * Check how many days in a month code.\n     * from https://dzone.com/articles/determining-number-days-month.\n     */\n    function daysInMonth(month, year) {\n        return 32 - new Date(year, month, 32).getDate();\n    }\n\n    /**\n     * Generate calendar markup for the month.\n     */\n    function generateCalendar(month, year, containerdiv) {\n\n        let firstDay = (new Date(year, month)).getDay();  // Get the starting day of the month.\n        var tbl = containerdiv.getElementsByTagName(\"tbody\")[0];\n        var monthEvents = eventArray[year][(month + 1)];  // We add one due to month diferences between PHP and JS.\n\n        // Clearing all previous cells.\n        tbl.innerHTML = \"\";\n\n        // Creating all cells.\n        let date = 1;\n\n        for (let i = 0; i < 6; i++) {\n            // Creates a table row.\n            let row = document.createElement(\"tr\");\n\n            // Creating individual cells, filing them up with data.\n            for (let j = 0; j < 7; j++) {\n                if (i === 0 && j < firstDay) {\n                    var cell = document.createElement(\"td\");\n                    var cellText = document.createTextNode(\"\");\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                }\n                else if (date > daysInMonth(month, year)) {\n                    break;\n                }\n\n                else {\n                    cell = document.createElement(\"td\");\n                    cellText = document.createTextNode(date);\n                    if ((typeof monthEvents !== \"undefined\") && (monthEvents.hasOwnProperty(date))) {\n                        var heatClass = \"heat-\" + monthEvents[date]['heat'];\n                        cell.classList.add(heatClass);\n                    }\n                    if (date === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {\n                        cell.classList.add(\"bg-info\");\n                    } // Color today's date.\n                    cell.appendChild(cellText);\n                    row.appendChild(cell);\n                    date++;\n                }\n\n            }\n\n            tbl.appendChild(row); // Appending each row into calendar body.\n        }\n\n    }\n\n    /**\n     * Initialise all of the modules for the assessment frequency block.\n     *\n     * @param {object} root The root element for the assessment frequency block.\n     */\n    Main.init = function(root) {\n        // Get the containers that will hold the months.\n        var calendarContainer = root;\n        var containerdivs = calendarContainer.children;\n\n        // Start with current month and year\n        var month = today.getMonth();\n        var year = today.getFullYear();\n\n        // Get the events to use in the mapping.\n        ajax.call([{\n            methodname: 'block_assessfreq_get_frequency',\n            args: {},\n        }])[0].done(function(response) {\n            eventArray = JSON.parse(response);\n            // Generate calendar on response.\n            for (let i = 0; i < containerdivs.length; i++) {\n                generateCalendar(month, year, containerdivs[i]);\n                month++;\n            }\n        }).fail(function(response) {\n            window.console.log(response);\n        });\n\n\n\n\n    };\n\n    return Main;\n});\n"],"file":"main.min.js"}